---
import { getLangFromUrl, useTranslations } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Importar imágenes
import imgManzana from '../assets/images/img_manzana.png';
import imgCereza from '../assets/images/img_cereza.png';  
import imgPalta from '../assets/images/img_palta.png';
import imgPasas from '../assets/images/img_pasas.png';
import imgNueces from '../assets/images/img_nueces.png';
import imgMandarina from '../assets/images/img_mandarinas.png';
import 'swiper/css';
import 'swiper/css/navigation';

// Cargar productos según el idioma
const productsData = await import(`../content/${lang}/products.json`);
const productsContent = productsData.default.products;

// Mapear imágenes a los productos
const productImages = [
  imgManzana.src,
  imgCereza.src,
  imgPalta.src,
  imgPasas.src,
  imgNueces.src,
  imgMandarina.src
];

const products = productsContent.map((product: any, index: number) => ({
  ...product,
  image: productImages[index]
}));
---

<section id="productos" class="py-20 bg-[#F5F5F0]">
  <div class="container mx-auto px-4">
    <!-- Section Header -->
    <div class="text-center mb-16">
      <span class="text-sm uppercase tracking-widest text-gray-500 font-medium">{t('products.badge')}</span>
      <h2 class="text-4xl md:text-5xl font-serif font-bold text-[#1a3c25] mt-3 mb-6">
        {t('products.title')}
      </h2>
      <p class="max-w-2xl mx-auto text-gray-600 text-lg">
        {t('products.description')}
      </p>
    </div>

    <!-- Products Carousel -->
    <div class="relative">
      <div class="swiper mySwiper !pb-12">
        <div class="swiper-wrapper !items-stretch">
          {[...products, ...products].map((product) => (
            <div class="swiper-slide !h-auto !flex">
              <div class="bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-300 group h-full flex flex-col w-full">
          <!-- Image Container -->
          <div class="relative h-64 overflow-hidden shrink-0">
            <img 
              src={product.image} 
              alt={product.title}
              class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
            />
            <!-- Icon Badge -->
            
          </div>

          <!-- Content -->
          <div class="p-6 flex flex-col flex-1">
            <h3 class="text-2xl font-serif font-bold text-[#1a3c25] mb-1">{product.title}</h3>
            <p class="text-sm text-gray-500 mb-6 font-medium">{product.varieties}</p>
            
            <div class="space-y-3">
              <p class="text-xs uppercase tracking-wider text-gray-400 font-semibold">{t('products.benefits.title')}</p>
              <ul class="space-y-2">
                {product.benefits.map((benefit: string) => (
                  <li class="flex items-start gap-2 text-sm text-gray-600">
                    <svg class="w-4 h-4 text-green-600 mt-0.5 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    {benefit}
                  </li>
                ))}
              </ul>
            </div>
          </div>
        </div>
        </div>
      ))}
      </div>
    </div>
    
    <!-- Navigation Buttons (acting as Fade Gradients) -->
    <div class="swiper-button-prev !left-0 !top-0 !w-24 md:!w-48 !h-[calc(100%-3rem)] !mt-0 !bg-gradient-to-r !from-[#F5F5F0] !to-transparent z-10 cursor-pointer flex items-center justify-start pl-4 group transition-opacity duration-300">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-10 h-10 text-[#98cda9] opacity-0 group-hover:opacity-100 transition-all duration-500 ease-out -translate-x-4 group-hover:translate-x-0"><path d="m15 18-6-6 6-6"/></svg>
    </div>
    <div class="swiper-button-next !right-0 !top-0 !w-24 md:!w-48 !h-[calc(100%-3rem)] !mt-0 !bg-gradient-to-l !from-[#F5F5F0] !to-transparent z-10 cursor-pointer flex items-center justify-end pr-4 group transition-opacity duration-300">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-10 h-10 text-[#98cda9] opacity-0 group-hover:opacity-100 transition-all duration-500 ease-out translate-x-4 group-hover:translate-x-0"><path d="m9 18 6-6-6-6"/></svg>
    </div>
  </div>

<script>
  import Swiper from 'swiper';
  import { Pagination, Autoplay, Navigation } from 'swiper/modules';

  const swiper = new Swiper('.mySwiper', {
    modules: [Pagination, Autoplay, Navigation],
    observer: true,
    observeParents: true,
    slidesPerView: 1.5,
    centeredSlides: true,
    spaceBetween: 20,
    loop: true,
    autoplay: {
      delay: 3500,
      disableOnInteraction: false,
    },
    pagination: {
      el: '.swiper-pagination',
      clickable: true,
      dynamicBullets: true,
    },
    navigation: {
      nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev',
    },
    breakpoints: {
      640: {
        slidesPerView: 2,
        spaceBetween: 20,
      },
      1024: {
        slidesPerView: 4,
        spaceBetween: 30,
      },
    },
  });
</script>

<style>
  :global(.swiper-pagination-bullet) {
    background-color: #1a3c25;
    opacity: 0.4;
  }
  :global(.swiper-button-next:after),
  :global(.swiper-button-prev:after) {
    content: none !important;
  }
  :global(.swiper-pagination-bullet-active) {
    background-color: #1a3c25;
    opacity: 1;
  }
</style>
  </div>
</section>
